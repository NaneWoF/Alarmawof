<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WOF Remote Panel</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; text-align: center; }
    .card { background: white; padding: 15px; border-radius: 10px; margin: 10px auto; max-width: 600px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .btn { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
    .btn:hover { background: #45a049; }
    .danger { background: #f44336; }
    .danger:hover { background: #d32f2f; }
    input, select { padding: 10px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; width: 90%; }
  </style>
</head>
<body>
  <div class="card">
    <h1>WOF Panel Remoto</h1>
    <div id="estado"></div>
    <button class="btn" onclick="toggleSalida()">Activar/Desactivar Salida</button>
    <br>
    <button class="btn" onclick="mostrarLogin()">Login Admin</button>
  </div>

  <div id="adminPanel" style="display:none;">
    <div class="card">
      <h2>Admin - Transmisores</h2>
      <div id="listaTransmisores"></div>
      <h3>Agregar Transmisor</h3>
      <input id="nombre" placeholder="Nombre"><br>
      <input id="direccion" placeholder="Direcci贸n"><br>
      <input id="codigo" placeholder="C贸digo"><br>
      <input id="idWeb" placeholder="ID Web"><br>
      <button class="btn" onclick="agregarTransmisor()">Guardar</button>
    </div>
  </div>

<script>
const dbURL = 'https://alarmaswof-default-rtdb.firebaseio.com';
let esAdmin = false;

function actualizarEstado() {
  fetch(`${dbURL}/relay1.json`)
    .then(r => r.json())
    .then(data => {
      document.getElementById("estado").innerHTML = `<p>Salida: <strong style='color:${data ? "green" : "red"}'>${data ? "ACTIVADA" : "DESACTIVADA"}</strong></p>`;
    });
}

function toggleSalida() {
  fetch(`${dbURL}/relay1.json`)
    .then(r => r.json())
    .then(actual => {
      fetch(`${dbURL}/relay1.json`, {
        method: 'PUT',
        body: JSON.stringify(!actual)
      }).then(actualizarEstado);
    });
}

function mostrarLogin() {
  const clave = prompt("Ingrese clave de administrador:");
  if (clave === "admin123") {
    esAdmin = true;
    document.getElementById("adminPanel").style.display = "block";
    cargarTransmisores();
  } else {
    alert("Clave incorrecta");
  }
}

function cargarTransmisores() {
  fetch(`${dbURL}/transmisores.json`)
    .then(r => r.json())
    .then(data => {
      const contenedor = document.getElementById("listaTransmisores");
      contenedor.innerHTML = "";
      if (!data) return;
      Object.entries(data).forEach(([key, val], i) => {
        const item = document.createElement("div");
        item.style.border = "1px solid #ccc";
        item.style.margin = "10px";
        item.style.padding = "10px";
        item.innerHTML = `<strong>${val.nombre}</strong><br>C贸digo: ${val.codigo}<br>Direcci贸n: ${val.direccion}<br>ID Web: ${val.idWeb}<br>
          <button class='btn danger' onclick='borrarTransmisor("${key}")'>Borrar</button>`;
        contenedor.appendChild(item);
      });
    });
}

function agregarTransmisor() {
  const nuevo = {
    nombre: document.getElementById("nombre").value,
    direccion: document.getElementById("direccion").value,
    codigo: parseInt(document.getElementById("codigo").value),
    idWeb: document.getElementById("idWeb").value
  };
  fetch(`${dbURL}/transmisores.json`, {
    method: 'POST',
    body: JSON.stringify(nuevo)
  }).then(() => {
    alert("Guardado");
    cargarTransmisores();
  });
}

function borrarTransmisor(clave) {
  fetch(`${dbURL}/transmisores/${clave}.json`, { method: 'DELETE' })
    .then(cargarTransmisores);
}

actualizarEstado();
setInterval(actualizarEstado, 5000);
</script>
</body>
</html>
